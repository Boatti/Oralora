document.addEventListener("DOMContentLoaded",function(){playerCommands(),scrollSnap()});try{const globalSection=document.querySelector("#globalSection");globalSection.addEventListener("scroll",scrollFunction)}catch{}function scrollFunction(){var e=document.getElementById("divLang");315<globalSection.scrollTop?(e.style.background="#05031B",document.getElementById("logo").style.opacity=1,document.getElementById("header").style.backgroundColor="#05031B"):(e.style.background="#cacaca",document.getElementById("logo").style.opacity=0,document.getElementById("header").style.backgroundColor="transparent")}function getNavigator(){return 0<=navigator.userAgent.toUpperCase().indexOf("MAC")}function scrollSnap(){var e=getNavigator(),t=document.getElementById("globalSection");t.style.scrollSnapType=e?"y mandatory":"none"}function playerCommands(){var e=document.getElementsByClassName("shortcut");getNavigator();e[0].innerHTML="(CTRL + L)",e[1].innerHTML="(CTRL + M)",e[2].innerHTML="(Space)"}var getIDYTB;if(sessionStorage.getItem("idYtb")){let e="divLoading",t=document.getElementById("divNotLoading"),n="divNotLoading",o="loading0",r="loadingSpinner0",c=document.getElementById("loading0");t.id=e,c.id=r,vidFromChall(getIDYTB=sessionStorage.getItem("idYtb"),o,n,c),sessionStorage.removeItem("idYtb")}async function vidFromChall(e,t,n,o){var r=document.getElementById("videoSection"),c=document.getElementById("guessSection");try{var a=await(await fetch("/id",{method:"POST",headers:{"Content-Type":"application/json"},body:e})).json()}catch(e){console.log(e)}r.style.display="flex",c.style.display="flex",clean=await cleanTranscript(a),clean=JSON.stringify(clean),clean=JSON.parse(clean),await loadAPIPls(e),countScore(clean),divLoading.id=n,o.id=t,document.querySelector("#guessSection").scrollIntoView(),document.addEventListener("keydown",function(e){e.ctrlKey&&"l"===e.key&&(e.preventDefault(),repeatAWord())}),document.addEventListener("keydown",function(e){e.ctrlKey&&"m"===e.key&&(e.preventDefault(),replayVideo())}),document.addEventListener("keydown",function(e){"Space"===e.code&&(e.preventDefault(),toggleVideo())}),input.focus()}function setIframeSource(){let e=inputUrl.value,t;var n=document.getElementById("invalidURL");if(e.startsWith("https://www.youtube.com/watch?v=")||e.includes("youtube.com"))-1!==e.indexOf("&")&&(e=e.split("&")[0]),t=e.split("=").pop();else{if(!e.startsWith("https://youtu.be/"))return n.innerHTML="Please enter a valid YouTube URL","URL Invalid";t=e.split("/").pop()}return n.innerHTML="",11<t.length?(n.innerHTML="Please enter a valid YouTube URL","URL Invalid"):t}function displayRules(){document.getElementById("divInformations").style.display="block",document.getElementById("cross").addEventListener("click",function(){document.getElementById("divInformations").style.display="none"})}function countScore(e){e=e.reduce(function(e,t){return e+t.text.split(" ").length},0);scoreDiv.innerHTML=0,document.getElementById("totalWords").innerHTML=e}function scrollToInput(){document.querySelector("#inputSection").scrollIntoView()}function millisToSeconds(e){return(e/1e3).toFixed(3)}let clean;const output=document.getElementById("foundArea"),input=document.getElementById("guessArea"),scoreDiv=document.getElementById("currentScore"),inputUrl=document.getElementById("urlInput");function cleanTranscript(e){e=e.map(e=>{var t=e.text?e.text.replace(/\[[^\]]+\]/g,"").replace(/\*[^*]+\*/g,"").replace(/\([^)]*\)/g,"").replace(/\n|-/g," ").replace(/\./g," ").replace(/\s+/g," ").replace(/[^a-z0-9-àâäéèêëîïôöùûüçáíóúñü \n']/gi,"").replace(/\bwhooah\s*|\bargh\s*|\baaaah\s*|\baaah\s*|\bwhoa\s*|\bhuh\s*/gi,"").replace(/\s+/g," "):"";return""===t.trim()?null:{...e,text:t.trim().toLowerCase()}}).filter(e=>null!==e);return"you"===e[e.length-1].text&&e.pop(),e}inputUrl.addEventListener("keydown",async function(t){if("Enter"==t.key||"NumpadEnter"==t.key){var t="loading",n=document.getElementById("loading"),e=document.getElementById("videoSection"),o=document.getElementById("guessSection");if(n.id="loadingSpinner","URL Invalid"===(getIDYTB2=setIframeSource()))inputUrl.value="",n.id=t;else{getIDYTB=getIDYTB2;try{var r=await(await fetch("/id",{method:"POST",headers:{"Content-Type":"application/json"},body:getIDYTB})).json()}catch(e){return document.getElementById("invalidURL").innerHTML="No subtitles are available for this video or it is intended for kids.",n.id=t,void(inputUrl.value="")}e.style.display="flex",o.style.display="flex",n.id=t,inputUrl.value="",clean=cleanTranscript(r),clean=JSON.stringify(clean),clean=JSON.parse(clean),loadAPIPls(getIDYTB),countScore(clean),inputUrl.blur(),document.querySelector("#guessSection").scrollIntoView(),document.addEventListener("keydown",function(e){e.ctrlKey&&"l"===e.key&&(e.preventDefault(),repeatAWord())}),document.addEventListener("keydown",function(e){e.ctrlKey&&"m"===e.key&&(e.preventDefault(),replayVideo())}),document.addEventListener("keydown",function(e){"Space"===e.code&&(e.preventDefault(),toggleVideo())}),input.focus()}}}),input.addEventListener("paste",function(e){e.preventDefault()}),input.addEventListener("keydown",function(e){"Backspace"!==e.key&&"Space"!==e.code||e.preventDefault()});let selectedSpans=[];function guessButton(){let e;try{e=clean[indexObject].text}catch(e){console.log(e)}var t,n=e.split(" ");currentWord=n[indexWord],cara=(cara=cara+" "+currentWord).trim(),0==indexWord&&0==indexObject&&(currentWord=currentWord.charAt(0).toUpperCase()+currentWord.slice(1)),output.innerHTML+="<span class='guessWords'>"+currentWord+"</span> ",cara!==clean[clean.length-1].text||null!==t&&null!==endOffset||(output.innerHTML+="<div id='strongEnd'>END</div>",input.disabled=!0,stopVideo(),document.getElementById("guessButton").removeAttribute("onclick"),document.getElementById("repeat").removeAttribute("onclick"),document.getElementById("replay").removeAttribute("onclick"),document.getElementById("play").removeAttribute("onclick")),indexWord++,cara===e&&(cara="",indexObject++,indexWord=0,countLoopInput++),countLoopInput==countLoop&&(countLoopInput=0,[n,t]=getOffset(),changeAll(getIDYTB,n,t)),indexLetter=0,input.value="",input.focus(),output.scrollTop=output.scrollHeight}output.addEventListener("click",function(t){if("SPAN"===t.target.tagName&&(t.target.style.background="#12a5d9",t.target.style.borderRadius="8px",selectedSpans.push(t.target),2===selectedSpans.length)){selectedSpans.sort(function(e,t){return Array.prototype.indexOf.call(e.parentNode.childNodes,e)-Array.prototype.indexOf.call(t.parentNode.childNodes,t)});var t=Array.prototype.indexOf.call(selectedSpans[0].parentNode.childNodes,selectedSpans[0]),n=Array.prototype.indexOf.call(selectedSpans[1].parentNode.childNodes,selectedSpans[1]);let e=Array.prototype.slice.call(selectedSpans[0].parentNode.childNodes,t,n+1).map(function(e){return e.textContent}).join(" ");e=e.replace(/   /g," "),setTimeout(()=>{window.open("https://www.deepl.com/translator#en/fr/"+e)},50),selectedSpans.forEach(function(e){setTimeout(()=>{e.style.background=""},50),setTimeout(()=>{e.style.borderRadius=""},50)}),selectedSpans=[]}});let indexObject=0,indexWord=0,indexLetter=0,score=0,currentWord;var cara="";let string,stringList,countLoopInput=0;input.addEventListener("input",function(t){input.placeholder="";try{string=clean[indexObject].text}catch(e){console.log(e)}stringList=string.split(" "),currentWord=stringList[indexWord];const n=t.target.value;setTimeout(()=>{for(let e=0;e<n.length;e++)if(n[e]!==currentWord[e]){t.target.value=n.substring(0,e);break}},50),input.value===currentWord&&(setTimeout(()=>{input.value=""},30),cara=(cara=cara+" "+currentWord).trim(),0==indexWord&&0==indexObject&&(currentWord=currentWord.charAt(0).toUpperCase()+currentWord.slice(1)),output.innerHTML+="<span>"+currentWord+"</span> ",score+=1,setTimeout(()=>{scoreDiv.innerHTML=score},100),indexWord++,indexLetter=0,currentWord=""),cara!==clean[clean.length-1].text||null!==o&&null!==endOffset||(output.innerHTML+="<div id='strongEnd'>END</div>",stopVideo(),input.disabled=!0,document.getElementById("guessButton").removeAttribute("onclick"),document.getElementById("repeat").removeAttribute("onclick"),document.getElementById("replay").removeAttribute("onclick"),document.getElementById("play").removeAttribute("onclick"));try{var e,o;cara===string&&(cara="",indexObject++,indexWord=0,countLoopInput++),countLoopInput==countLoop&&(countLoopInput=0,[e,o]=getOffset(),changeAll(getIDYTB,e,o))}catch(e){console.log(e)}output.scrollTop=output.scrollHeight});